<%- include('header', { title: 'actual-monzo-pots' }) %>
<div class="container py-5">
  <div class="text-center mb-4">
    <h1 class="mb-0">actual-monzo-pots</h1>
  </div>
  <div class="text-center mb-3">
    <span id="budgetStatus" class="badge bg-info">Budget downloading</span>
  </div>
  <div class="d-flex justify-content-between align-items-center mb-4">
    <a id="authBtn" href="/auth" class="btn btn-secondary">Authenticate Monzo</a>
    <% if (uiAuthEnabled) { %>
      <form method="post" action="/logout" class="m-0">
        <button type="submit" class="btn btn-warning">Logout</button>
      </form>
    <% } %>
  </div>
    <div id="accountsList" class="mb-4">
      <h2 class="h5">Monzo Accounts</h2>
      <table class="table table-sm table-bordered">
        <thead><tr>
          <th>ID</th>
          <th>Description</th>
          <th>Owner</th>
          <th>Type</th>
          <th>Account #</th>
          <th>Currency</th>
        </tr></thead>
        <tbody id="accountsBody"></tbody>
      </table>
    </div>
    <div id="mappingForm">
      <table class="table table-bordered">
        <thead><tr>
          <th>Pot</th>
          <th>Account</th>
          <th>Owner</th>
          <th>Actual Account</th>
        </tr></thead>
        <tbody id="mappingBody"></tbody>
      </table>
      <div class="d-flex align-items-center gap-2">
        <button id="saveBtn" class="btn btn-primary">Save Mappings</button>
        <button id="syncBtn" class="btn btn-success">Sync Now</button>
        <span id="status"></span>
      </div>
    </div>
  </div>
  <script>
    // Pass server data into front-end
    window.__UI_CONFIG = {
      hadRefreshToken: <%= hadRefreshToken %>,
      refreshError: <%- JSON.stringify(refreshError) %>
    };
  </script>
  <script src="/js/index.js"></script>
<%- include('footer') %>